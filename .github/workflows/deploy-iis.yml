name: ๐ Deploy .NET app to IIS on Self-Hosted Runner

on:
  push:
    branches: [ main ]  # ุณูุชู ุชุดุบูู ูุฐู ุงูุนูููุฉ ููุท ุนูุฏ ุญุฏูุซ push ุนูู ุงููุฑุน ุงูุฑุฆูุณู

jobs:
  build-and-deploy:
    runs-on: self-hosted  # ุนูููุฉ ุงูุจูุงุก ูุงููุดุฑ ุณุชุชู ุนูู ุฌูุงุฒ ุฎุงุฏู ูุญูู (self-hosted runner)

    steps:
    - name: ๐ฅ Checkout code
      uses: actions/checkout@v3  # ูุฐู ุงูุฎุทูุฉ ุชููู ุจุชุญููู ุงูููุฏ ูู ูุณุชูุฏุน GitHub ุฅูู ุงูุฎุงุฏู ุงูุฐู ูููุฐ ุงูู CI/CD

    - name: ๐๏ธ Setup .NET
      uses: actions/setup-dotnet@v3  # ุฅุนุฏุงุฏ ุงูุจูุฆุฉ ุงูุฎุงุตุฉ ุจู .NET ุจุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ ุงููุญุฏุฏ
      with:
        dotnet-version: '9.0.302'  # ุชุญุฏูุฏ ุฅุตุฏุงุฑ .NET ุงููุณุชุฎุฏู ูู ุนูููุฉ ุงูุจูุงุก

    - name: ๐๏ธ Restore dependencies
      run: dotnet restore  # ุชุญููู ุฌููุน ุงูุญุฒู ูุงูุงุนุชูุงุฏุงุช (dependencies) ูู ููู ุงูู .csproj ุฃู ุงูู solution

    - name: ๐จ Build project
      run: dotnet build --configuration Release --no-restore  # ุจูุงุก ุงููุดุฑูุน ุจุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ุงูุฅุตุฏุงุฑุ ุฏูู ุชูุฑุงุฑ ุนูููุฉ ุงูุงุณุชุนุงุฏุฉ

    - name: ๐ฆ Publish project
      run: dotnet publish -c Release -o ./publish  # ูุดุฑ ุงููุดุฑูุน ุฅูู ูุฌูุฏ ูุคูุช ูุณูู "publish" ููุชููุฆุฉ ุงูููุงุฆูุฉ ูููุดุฑ

    - name: ๐ Stop IIS site
      run: |
        Import-Module WebAdministration  # ุงุณุชูุฑุงุฏ ุงููุญุฏุฉ ุงูุฎุงุตุฉ ุจู IIS ูู PowerShell
        Stop-Website -Name "ecomerce"  # ุฅููุงู ุงููููุน ุนูู IIS ูุจู ุงุณุชุจุฏุงู ุงููููุงุช
      shell: powershell  # ุงุณุชุฎุฏุงู PowerShell ูุชูููุฐ ุงูุฃูุงูุฑ

    - name: ๐ Deploy to IIS folder (safe & fast)
      run: robocopy ./publish "C:\inetpub\wwwroot\ecomerce" /E /XO /XN /XX /NJH /NJS /NP  # ูุณุฎ ุงููููุงุช ุฅูู ูุฌูุฏ IIS ุจุงุณุชุฎุฏุงู robocopy
      shell: cmd  # ุงุณุชุฎุฏุงู ููุฌู ุงูุฃูุงูุฑ ูุชูููุฐ ูุฐุง ุงูุฃูุฑ

    - name: โถ๏ธ Start IIS site
      run: |
        Import-Module WebAdministration  # ุงุณุชูุฑุงุฏ ุงููุญุฏุฉ ุงูุฎุงุตุฉ ุจู IIS ูุฑุฉ ุฃุฎุฑู ูุชุดุบูู ุงููููุน
        Start-Website -Name "ecomerce"  # ุฅุนุงุฏุฉ ุชุดุบูู ุงููููุน ุนูู IIS ุจุนุฏ ุงุณุชุจุฏุงู ุงููููุงุช
      shell: powershell  # ุงุณุชุฎุฏุงู PowerShell ูุชูููุฐ ุงูุฃูุงูุฑ
